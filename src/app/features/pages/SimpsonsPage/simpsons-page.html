<app-breadcrumbs
  [items]="[
    { label: 'Inicio', link: '/' },
    { label: 'Simpsons', link: '/simpsons' },
    { label: 'Personajes' }
  ]"
/>

<section class="p-6">
  <app-hero-simpsons
    [simpsonsCount]="simpsonsResource()?.count ?? 0"
    [totalPages]="totalPages()"
  ></app-hero-simpsons>

  <div class="mt-8 space-y-6">
    @if (totalPages() > 0) {
      <div class="flex gap-2 items-center h-20 mb-4">
        <app-pagination
          [pages]="totalPages()"
          [currentPage]="paginationService.currentPage()"
        />

        <div class="flex flex-1"></div>
      </div>
    }

    @if (simpsonsResource() === null) {
      <div class="flex justify-center items-center h-64">
        <span class="loading loading-spinner loading-lg"></span>
      </div>
    } @else {
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="text-sm text-neutral-500">
          Pagina {{ paginationService.currentPage() }} de {{ totalPages() || '...' }}
        </div>
      </div>

      @if ((simpsonsResource()?.results?.length ?? 0) === 0) {
        <div class="alert alert-warning">
          <span>No se pudieron cargar personajes. Intenta recargar o cambia de pagina.</span>
        </div>
      } @else {
        <div class="overflow-x-auto bg-base-100 rounded-xl shadow-sm border border-base-200">
          <table class="table">
            <thead>
              <tr>
                <th>Avatar</th>
                <th>Nombre</th>
                <th>Ocupacion</th>
                <th>Estado</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              @for (personaje of simpsonsResource()?.results ?? []; track personaje.id) {
                <tr>
                  <td>
                    <div class="avatar">
                      <div class="mask mask-squircle w-12 h-12">
                        <img [src]="characterImage(personaje.portrait_path)" [alt]="personaje.name" />
                      </div>
                    </div>
                  </td>
                  <td class="font-semibold">{{ personaje.name }}</td>
                  <td>{{ personaje.occupation }}</td>
                  <td>
                    <span
                      class="badge"
                      [class.badge-success]="personaje.status === 'Alive'"
                      [class.badge-error]="personaje.status !== 'Alive'"
                    >
                      {{ personaje.status }}
                    </span>
                  </td>
                  <td class="text-right">
                    <a [routerLink]="['/simpsons', personaje.id]" class="btn btn-sm btn-primary">
                      Ver Detalle
                    </a>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    }
  </div>
</section>
